import{f as e,v as l,Q as a,I as t,x as o,bO as s,R as n,bP as i,ak as u,c as r,K as d,o as c,F as v,b as m,B as p,H as b,J as y,a4 as g,G as f,i as w,w as x,d as k,C as h,t as B,bM as S,E as T,s as V,a as _,aE as F,U as q,bg as A,ad as N,a0 as C,a2 as I,bR as z,bS as E,bT as L,bU as $,bV as j,bW as G,bX as M,m as R,bY as U}from"./CcL3nfnm.js";import{u as W}from"./Ci_vqn2m.js";import{r as O,u as P}from"./CLl1N47J.js";const Q={key:1,class:"ml-5px"},D={class:"text-20px"},H={class:"min-h-60px py-10px"},J={class:"text-16px"},K={class:"flex mt-10px"},X={key:0,class:"ml-5px"},Y=e({__name:"quickSwap",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},size:{default:"14px"},buttonType:{default:0}},emits:["submitSwap","jump"],setup(e,{emit:Y}){const{walletSwap:Z,loadingWalletSwap:ee}=W(),{t:le}=l(),ae=e,te=a(),oe=t(!1),se=t(!1),ne=t(""),ie=o("noReminderQuickBuy",!1),ue=Y;function re(){var e;if(ue("submitSwap"),!N())return;if(oe.value)return;if(1===ae.buttonType&&new C(ae.quickBuyValue||0).lte(0))return void I({type:"error",plain:!0,message:le("buyAmountMustG0"),duration:1e3});if(new C(ae.quickBuyValue||0).lte(0))return void z({title:"Error",type:"error",message:le("amountMustG0")});const{row:l}=ae;ne.value=le("quickBuyMsg",{a:ae.quickBuyValue,m:(null==(e=S(ae.row.chain))?void 0:e.main_name)||"",s:l.symbol||(l.target_token==l.token0_address?l.token0_symbol:l.token1_symbol)}),ie.value||1===ae.buttonType?me():se.value=!0}const de=t(),ce=s(),ve=n();async function me(){var e;if(ve.provider&&ve.address&&!te.evmAddress)return void async function(){const e=new C(ae.quickBuyValue||0).toFixed();Z(e,ae.row)}();se.value=!1;const{chain:l}=ae.row;oe.value=!0,await async function(e){var l;const a=te.getWalletAddress(e);if(!a)return;const t=await U({chain:e,tokens:[$(e)],walletAddress:a}),o=(null==t?void 0:t[0])||{};de.value={...o,symbol:null==(l=S(e))?void 0:l.main_name,chain:e,address:o.token||o.address,decimals:o.decimals||o.decimal}}(l);const a=de.value,t=null==(e=new C(ae.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(t)||0)<=0?(z({title:"Error",type:"error",message:le("amountTooSmall")}),void(oe.value=!1)):new C(t||0).gt((null==a?void 0:a.balance)||0)?(z({title:"Error",type:"error",message:le("insufficientBalance")}),void(oe.value=!1)):void async function(e){var l,a,t;const{chain:o}=ae.row,s="solana"===o,{botSettings:n}=ce,i=null==(l=null==n?void 0:n[o])?void 0:l.selected,u=null==(a=null==n?void 0:n[o])?void 0:a[i];if(s&&(null==u?void 0:u.mev)&&!(await te.getBundleAvailable()))return void(oe.value=!1);const{gasTip1List:r,gasTip2List:d}=E(L().gasTip,"solana"),c=(null==u?void 0:u.mev)?r:d,v=(null==u?void 0:u.mev)?null==u?void 0:u.gas[0]:null==(t=null==u?void 0:u.gas)?void 0:t[1];let m={};if(s){let e=(null==v?void 0:v.customFee)||(null==c?void 0:c[null==v?void 0:v.level])||"0.002";(null==u?void 0:u.mev)&&new C(e).lt("0.002")&&(e="0.002"),m.priorityFee=new C(e).times(10**9).toFixed(0)}else{const e=0===Number(null==v?void 0:v.customFee)?"0":(null==v?void 0:v.customFee)||(null==c?void 0:c[null==v?void 0:v.level])||"3";m.gasTip=Number(new C(e).times(10**9).toFixed(0)),m.contractType=0,m.chain=o}const p=$(o),b=(null==u?void 0:u.slippage)||"9",y=te.getWalletAddress(o);if(!y)return;m={...m,batchId:Date.now().toString(),swapList:[{creatorAddress:y,inAmount:new C(e||0).times(10**de.value.decimals||0).toFixed(0)}],inTokenAddress:p,outTokenAddress:ae.row.token||ae.row.target_token,swapType:1,isPrivate:(null==u?void 0:u.mev)||!1,slippage:"auto"!==b?Number(new C(b).times(100).toFixed(0)):900,autoSell:ce.autoSellConfig_autoSell||!1,autoSellConfig:null==ce?void 0:ce.autoSellConfig,autoGas:(null==v?void 0:v.customFee)?0:((null==v?void 0:v.level)||0)+1,autoSellGas:(null==v?void 0:v.customFee)?0:((null==v?void 0:v.level)||0)+1,autoSellPriorityFee:s?m.priorityFee:m.gasTip};(s?j(m):G(m)).then((e=>function(e,l){if(e){let a=setTimeout((()=>{z({type:"success",message:le("transactionsSubmitted")}),pe.placeOrderUpdate++,oe.value=!1}),500);const t=ae.row.chain,o=(null==e?void 0:e[0])||{};O({txInfo:o,chain:t,destination:"solana"===t?"/botapi/swap/createSolTx":"/botapi/swap/createSwapEvmTx",type:10});const s={[null==o?void 0:o.batchId]:null==o?void 0:o.id},n=R((()=>be.wsResult.tgbot),(e=>{var t,o,i,u,r;const d=e.batchId;if(d===l){if(a&&(clearTimeout(a),a=null),pe.placeOrderSuccess++,null==(o=null==(t=null==e?void 0:e.txList)?void 0:t[0])?void 0:o.success){z({type:"success",message:le("tradeSuccess")}),ue("jump");const l=null==(i=null==e?void 0:e.txList)?void 0:i[0];P({...l,chain:null==e?void 0:e.chain},(null==s?void 0:s[d])||"")}else M((null==(r=null==(u=null==e?void 0:e.txList)?void 0:u[0])?void 0:r.failMessage)||"swap error");n(),oe.value=!1}}))}}(e,m.batchId))).catch((e=>{M(e||"swap error"),oe.value=!1}))}(t)}const pe=i(),be=u();return(e,l)=>{const a=h,t=b,o=F,s=T;return 0===e.buttonType?(c(),r(v,{key:0},[m(t,{disabled:!Number(e.quickBuyValue),loading:w(oe)||w(ee),color:e.buttonBg,class:f(["flex items-center [&&]:px-8px [&&]:py-5px [&&]:h-auto",e.classNames]),style:g([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:y(re,["stop","prevent"])},{default:x((()=>{var l;return[w(oe)||w(ee)?p("",!0):(c(),d(a,{key:0,style:g({"font-size":e.size}),class:"mr-4px",name:"mynaui:lightning-solid"},null,8,["style"])),k(" "+B(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(c(),r("span",Q,B((null==(l=("getChainInfo"in e?e.getChainInfo:w(S))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]})),_:1},8,["disabled","loading","color","class","style"]),w(se)?(c(),d(s,{key:0,modelValue:w(se),"onUpdate:modelValue":l[1]||(l[1]=e=>V(se)?se.value=e:null),title:e.$t("buy"),width:"400px","append-to":e.appendTo},{header:x((()=>[_("span",D,B(e.$t("buy")),1)])),footer:x((()=>[m(t,{type:"primary",class:"w-full",size:"large",onClick:y(me,["stop"])},{default:x((()=>[k(B(e.$t("confirm1")),1)])),_:1})])),default:x((()=>[_("div",H,[_("div",J,B(w(ne)),1),_("div",K,[m(o,{modelValue:w(ie),"onUpdate:modelValue":l[0]||(l[0]=e=>V(ie)?ie.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:e.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])])),_:1},8,["modelValue","title","append-to"])):p("",!0)],64)):(c(),d(t,{key:1,loading:w(oe)||w(ee),color:e.buttonBg,class:f(["flex items-center [&&]:px-4px",e.classNames]),style:g([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:y(re,["stop","prevent"])},{default:x((()=>{var l;return[q(m(a,{class:"mr-4px text-12px",name:"mynaui:lightning-solid"},null,512),[[A,!w(oe)]]),k(" "+B(Number(e.quickBuyValue)?e.quickBuyValue||0:e.$t("buy"))+" ",1),e.mainNameVisible&&Number(e.quickBuyValue)?(c(),r("span",X,B((null==(l=("getChainInfo"in e?e.getChainInfo:w(S))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]})),_:1},8,["loading","color","class","style"]))}}});export{Y as _};
